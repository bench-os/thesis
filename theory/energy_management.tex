\section{Energy management}

%to read
%https://dl.acm.org/citation.cfm?id=2333680
%https://dl.acm.org/citation.cfm?id=860179
%https://dl.acm.org/citation.cfm?id=860184
%https://ieeexplore.ieee.org/abstract/document/4054780
%http://www.es.mdh.se/pdf_publications/327.pdf
%https://www.sciencedirect.com/science/article/pii/S030626191630678X
%https://ieeexplore.ieee.org/abstract/document/5944309
%https://ieeexplore.ieee.org/abstract/document/8617010

%read
%https://www.sciencedirect.com/science/article/pii/S0167739X18329194


% \paragraph{}
% With the rise of cheap battery-powered embedded systems, the problem of energy efficiency becomes a non-negligeable stake.
% Each RTOS has its own way to manage its energy consumption.
% From a more general point of view, we can distinguish 2 ways to save energy in an embedded system.


% \subsection{Hardware energy management}

% At first, one could think that the hardware side of energy management is slightly out of context of the operating system means to save energy.
% The fact is that, even if we can distinguish 2 categories, the hardware means to save energy are very often tied to the upper layers of the whole system.

% \subsection{Software energy management}

\paragraph{}
The focus on energy management is something fairly recent in the field of IT.
With the rise of the Internet of Things, advancements have been made to allow operating systems to manage energy consumption more efficiently.

Numerous communication stacks focused on IoT and low energy consumption have been developped in the last decade.
%cite examples

Unfortunately lesser attention has been paid to the design of energy efficient operating systems for resource-constrained devices.
Traditional hardware is limited in term of energy management and the progress in this field required both software and hardware to evolve.
We will present the advancements made and the technologies developped below.


\subsection{Hardware power management}
\paragraph{}
In order to implement advanced techniques of energy management, certain hardware features have been developped.
The purpose is to give more control from the software over the hardware.

\subsubsection{Clock Gating}
% https://m.eet.com/media/1157354/fpmm%20-%20part%201.pdf
% https://en.wikipedia.org/wiki/Clock_gating
\paragraph{}
Clock Gating is a technique consisting of turning off the clocks of unused peripherals in order to save energy.
Those peripherals enter what is called \textit{idle state} or \textit{sleep}.
The clocks are physically switched off from the circuit with the addition of a logical gate and do not consume energy until reactivation.

\subsubsection{CPU Power Down Modes}
\paragraph{}
The recent advancements in central processing units have introduced power saving modes.
This feature stops the CPU clocks so that it is put on sleep unless
    a scheduling event or interrupt is triggered and wakes the CPU up (with the help of a Real-Time Clock for example).
% How the event can be scheduled if there is no clock to check the event ?

\subsubsection{Real-Time Clock Wake Up Support}
% https://www.electronics-tutorials.ws/connectivity/real-time-clocks.html
\paragraph{}
When a CPU is in sleep mode, there is two possibilities to wake it up from sleep mode: % Link with the previous subsubsection ?
With an on-chip Real-Time Clock (RTC) or by an external event.
The on-chip Real-Time Clock is a low frequency clock (usually around 32kHz) that does not drain a lot of battery life.
RTCs can include alarm functions â€“ timers that when reached trigger the RTC to wake the processor up.

\subsubsection{Supported CPU Frequencies / Dynamic frequency scaling}
\paragraph{}
In modern CPU's, many options are available to switch between frequency ranges depending on the resources needed.
This feature can be used to minimize power consumption when the we don't need much computational power.

\subsubsection{Adaptive Voltage Scaling / Dynamic Voltage Scaling}
\paragraph{}
%https://www.eetimes.com/document.asp?doc_id=1271842#
Similarly to the CPU's frequency, voltage can vary based on the actual state of the chip.
The voltage is continuously monitored and adjusted during the runtime.


\subsection{Operating system power management}

\subsubsection{Peripherals State Control}
\paragraph{}
Peripherals state control makes use of the clock gating feature provided by the hardware.
Thanks to this feature, only the peripherals clocks required by the application at a certain point in time are active.
The other clocks are in halt mode and do not consume energy.

\subsubsection{Sleep Mode}
\paragraph{}
The idea is to allow the system to switch off certain components of the microprocessor.

The sleep mode of a microprocessor takes advantage of multiple hardware features
    such as adaptative voltage scaling, CPU power down modes and dynamic frequency scaling.
The RTC Wake Up Support serves to wake the CPU up when in sleep mode and no other source is active.

\subsubsection{Tick Suppression}
%https://www.embedded.com/electronics-blogs/industry-comment/4414162/1/FreeRTOS-s-tick-suppression-saves-power
\paragraph{}
Tick suppression defines the principle of providing tick-less support for the scheduler.

In a regular scheduler, a periodic timer (tick interrupt) is used to track time.
This tick interrupt wakes the CPU up to perform a scheduling cycle.
Such a mechanism, even if punctual, is frequent and then depletes energy in a non-negligeable way by entering and exiting sleep mode frequently.

In a tick-less scheduler, the tick interrupt is disabled when the idle task is running.
Stopping the tick interrupt allows the CPU to remain in a deep power saving state 
    until either an interrupt occurs or it is time for the kernel to switch task.

%schema tick vs tickless scheduler